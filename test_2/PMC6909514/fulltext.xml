<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.2 20190208//EN" "JATS-archivearticle1-mathml3.dtd"> 
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article"><?properties open_access?><?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?><?DTDIdentifier.IdentifierType public?><?SourceDTD.DTDName A++V2.4.dtd?><?SourceDTD.Version 2.4?><?ConverterInfo.XSLTName springer2nlmx2.xsl?><?ConverterInfo.Version 1?><front><journal-meta><journal-id journal-id-type="nlm-ta">Genome Biol</journal-id><journal-id journal-id-type="iso-abbrev">Genome Biol</journal-id><journal-title-group><journal-title>Genome Biology</journal-title></journal-title-group><issn pub-type="ppub">1474-7596</issn><issn pub-type="epub">1474-760X</issn><publisher><publisher-name>BioMed Central</publisher-name><publisher-loc>London</publisher-loc></publisher></journal-meta><article-meta><article-id pub-id-type="pmcid">6909514</article-id><article-id pub-id-type="publisher-id">1865</article-id><article-id pub-id-type="doi">10.1186/s13059-019-1865-2</article-id><article-categories><subj-group subj-group-type="heading"><subject>Method</subject></subj-group></article-categories><title-group><article-title>Vireo: Bayesian demultiplexing of pooled single-cell RNA-seq data without genotype reference</article-title></title-group><contrib-group><contrib contrib-type="author" corresp="yes"><name><surname>Huang</surname><given-names>Yuanhua</given-names></name><address><email>yuanhua@ebi.ac.uk</email></address><xref ref-type="aff" rid="Aff1">1</xref><xref ref-type="aff" rid="Aff2">2</xref></contrib><contrib contrib-type="author" corresp="yes"><name><surname>McCarthy</surname><given-names>Davis J.</given-names></name><address><email>dmccarthy@svi.edu.au</email></address><xref ref-type="aff" rid="Aff2">2</xref><xref ref-type="aff" rid="Aff3">3</xref><xref ref-type="aff" rid="Aff4">4</xref></contrib><contrib contrib-type="author" corresp="yes"><name><surname>Stegle</surname><given-names>Oliver</given-names></name><address><email>o.stegle@dkfz.de</email></address><xref ref-type="aff" rid="Aff2">2</xref><xref ref-type="aff" rid="Aff5">5</xref><xref ref-type="aff" rid="Aff6">6</xref></contrib><aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ISNI">0000000121885934</institution-id><institution-id institution-id-type="GRID">grid.5335.0</institution-id><institution>Department of Clinical Neurosciences, University of Cambridge, </institution></institution-wrap>Cambridge, CB2 0QQ UK </aff><aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0000 9709 7726</institution-id><institution-id institution-id-type="GRID">grid.225360.0</institution-id><institution>European Molecular Biology Laboratory, European Bioinformatics Institute, </institution></institution-wrap>Wellcome Genome Campus, Hinxton, Cambridge, CB10 1SD UK </aff><aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0626 201X</institution-id><institution-id institution-id-type="GRID">grid.1073.5</institution-id><institution>St Vincent&#x02019;s Institute of Medical Research, </institution></institution-wrap>Fitzroy, Victoria, 3065 Australia </aff><aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2179 088X</institution-id><institution-id institution-id-type="GRID">grid.1008.9</institution-id><institution>Melbourne Integrative Genomics, University of Melbourne, </institution></institution-wrap>Parkville, Victoria, 3010 Australia </aff><aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0495 846X</institution-id><institution-id institution-id-type="GRID">grid.4709.a</institution-id><institution>European Molecular Biology Laboratory, Genome Biology Unit, </institution></institution-wrap>Heidelberg, 69117 Germany </aff><aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0492 0584</institution-id><institution-id institution-id-type="GRID">grid.7497.d</institution-id><institution>Division of Computational Genomics and Systems Genetics, German Cancer Research Center (DKFZ), </institution></institution-wrap>Heidelberg, 69120 Germany </aff></contrib-group><pub-date pub-type="epub"><day>13</day><month>12</month><year>2019</year></pub-date><pub-date pub-type="pmc-release"><day>13</day><month>12</month><year>2019</year></pub-date><pub-date pub-type="collection"><year>2019</year></pub-date><volume>20</volume><elocation-id>273</elocation-id><history><date date-type="received"><day>3</day><month>4</month><year>2019</year></date><date date-type="accepted"><day>25</day><month>10</month><year>2019</year></date></history><permissions><copyright-statement>&#x000a9; The Author(s) 2019</copyright-statement><license license-type="OpenAccess"><license-p><bold>Open Access</bold> This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The Creative Commons Public Domain Dedication waiver(<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated.</license-p></license></permissions><abstract id="Abs1"><p id="Par1">Multiplexed single-cell RNA-seq analysis of multiple samples using pooling is a promising experimental design, offering increased throughput while allowing to overcome batch variation. To reconstruct the sample identify of each cell, genetic variants that segregate between the samples in the pool have been proposed as natural barcode for cell demultiplexing. Existing demultiplexing strategies rely on availability of complete genotype data from the pooled samples, which limits the applicability of such methods, in particular when genetic variation is not the primary object of study. To address this, we here present Vireo, a computationally efficient Bayesian model to demultiplex single-cell data from pooled experimental designs. Uniquely, our model can be applied in settings when only partial or no genotype information is available. Using pools based on synthetic mixtures and results on real data, we demonstrate the robustness of Vireo and illustrate the utility of multiplexed experimental designs for common expression analyses.</p></abstract><kwd-group xml:lang="en"><title>Keywords</title><kwd>Multiplexing</kwd><kwd>Single-cell RNA-seq</kwd><kwd>Genetic variation</kwd><kwd>Variational Bayes</kwd></kwd-group><custom-meta-group><custom-meta><meta-name>issue-copyright-statement</meta-name><meta-value>&#x000a9; The Author(s) 2019</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="Sec1"><title>Background</title><p>Single-cell RNA-seq (scRNA-seq) is a rapidly evolving technology. Robust protocols and reduced costs have fostered applications in biomedicine, for example to identify biomarkers in disease [<xref ref-type="bibr" rid="CR1">1</xref>, <xref ref-type="bibr" rid="CR2">2</xref>], or to characterize the cellular response to treatment and other external stimuli [<xref ref-type="bibr" rid="CR3">3</xref>, <xref ref-type="bibr" rid="CR4">4</xref>].</p><p>Across these use cases, multiplexed experimental designs that combine multiple samples in a single experiment have critical statistical advantages compared to the serial analysis of samples in independent experimental batches [<xref ref-type="bibr" rid="CR5">5</xref>, <xref ref-type="bibr" rid="CR6">6</xref>]. In particular, pooled designs allow disentangling true inter-individual variation from experimental batch variation. Pooled designs whereby a large number of cells from distinct samples are processed in a joint fashion are facilitated by the availability of droplet sequencing methods in particular, including Drop-seq [<xref ref-type="bibr" rid="CR7">7</xref>] and the 10x Genomics Chromium platform [<xref ref-type="bibr" rid="CR8">8</xref>], which can assay tens of thousands of cells in a single run.</p><p>The aforementioned advantages have motivated a series of barcoding strategies to demultiplex samples from pooled experiments. In addition to simplified experimental logistics and reduced batch variation, pooled designs can also facilitate the identification of doublet cells. Existing barcoding strategies include molecular labelling prior to analysis [<xref ref-type="bibr" rid="CR9">9</xref>&#x02013;<xref ref-type="bibr" rid="CR12">12</xref>] as well as exploiting natural genetic barcodes of germline variants that segregate between pooled individuals [<xref ref-type="bibr" rid="CR13">13</xref>]. While molecular barcoding is in principle applicable to any study design, genetic barcoding is both elegant and can be seamlessly integrated in existing scRNA-seq workflows, without the need to introduce additional processing steps.</p><p>Multiplexed designs with genetic barcoding are particularly applicable in biomedical research, where the analysis of larger cohorts of genetically distinct individuals is particularly relevant [<xref ref-type="bibr" rid="CR14">14</xref>]. However, current methods for demultiplexing genetically barcoded pools, such as Demuxlet [<xref ref-type="bibr" rid="CR13">13</xref>], require genotype reference data for the pooled samples. Using variant information extracted from the scRNA-seq reads, each cell is then assigned to a sample in the pool based on its genetic distance to genotypic states in the genotype reference database. While there is a growing interest in multi-sample analyses to study the effect of genetic variation between individuals at single-cell level, e.g., [<xref ref-type="bibr" rid="CR15">15</xref>&#x02013;<xref ref-type="bibr" rid="CR17">17</xref>], the requirement to supply a genotype reference database is prohibitive for studies without a genetic focus per se. Consequently, the potential of pooled experimental designs is currently not realized.</p><p>To address this, we here present Vireo (Variational Inference for Reconstructing Ensemble Origins), a principled Bayesian method to demultiplex arbitrary pooled designs that combine genetically distinct individuals. Uniquely, Vireo models the genotypes of each individual as latent variables, which are inferred from the observed scRNA-seq reads. The model can also leverage partial genotype information, e.g., when genotype data are available for a subset of individuals, and hence can be applied to a wide range of experimental settings.</p></sec><sec id="Sec2"><title>Results and discussion</title><p>Vireo jointly assigns each cell to one of <italic>K</italic> individuals and estimates the genotypic state of these individuals at known polymorphic loci. Specifically, the model takes a set of common genetic variants as input (for example derived from the 1000 Genomes Project [<xref ref-type="bibr" rid="CR18">18</xref>]), which are genotyped in each cell based on the scRNA-seq read data. Despite the typically low coverage of single-cell RNA-seq experiments, this approach allows for genotyping on the order of 100 expressed variants per cell (e.g., using 3&#x02019; 10 &#x000d7; Genomics data; approx. 50,000 reads per cell, Fig.&#x000a0;<xref rid="Fig1" ref-type="fig">1</xref> and Methods). By aggregating information across cells, these sparse genotype data are sufficient to reconstruct partial genotypic state of the individuals in the pool, which in turn allows for probabilistic demultiplexing whereby each cell is assigned to one of these individuals (Fig.&#x000a0;<xref rid="Fig1" ref-type="fig">1</xref>). Vireo also accounts for the possibility of doublets (two or more cells processed as a &#x0201c;single cell&#x0201d; in the assay), by considering cells with variants that are most consistent with a genotypic state formed by the combination of two individuals. Finally, the model estimates the most likely number of pooled individuals, a feature that is useful if some of the pooled samples drop out for experimental reasons, and the method can incorporate partial genotype data that are available for a subset of the pooled samples.
<fig id="Fig1"><label>Fig. 1</label><caption><p>Illustration of Vireo for demultiplexing multi-sample scRNA-seq studies without reference genotype data. <bold>a</bold>, <bold>b</bold> The inference is based on genotyped common polymorphic variants in each cell, defined based on a standard reference of common human variants. <bold>b</bold>, <bold>c</bold> The resulting sparse read count matrices of alternative and reference alleles (displayed as compound matrix for simplicity; NA in white denotes no observed reads) are then decomposed into a matrix of estimated genotypes for each input sample and a probabilistic cell assignment matrix</p></caption><graphic xlink:href="13059_2019_1865_Fig1_HTML" id="MO1"/></fig></p><sec id="Sec3"><title>Model validation using synthetic data</title><p>Initially, we considered synthetic data with a known truth to validate our approach. We considered raw 3&#x02019; single-cell RNA-seq data from the 10x Genomics platform (v2 kit) for 16 genetically distinct samples from the census of immune cells project that are available from the Human Cell Atlas (Methods) [<xref ref-type="bibr" rid="CR19">19</xref>]. We then synthetically mixed 8 of these samples (1000 cells per sample and 4000 UMIs per cell on average), and simulated 8% of the cells as doublets, which were included alongside the sampled singlet cells (&#x0201c;singlets"; Methods). Initially, we evaluated Vireo&#x02019;s ability to estimate the number of input samples, by comparing the marginal likelihood of multiple Vireo runs assuming increasing numbers of samples in the pool, ranging from six to twelve. Notably, models with at least the true number of input samples (<italic>K</italic>=8) were differentiated from models with too low sample counts based on the elbow plot of the variational lower bound (Fig.&#x000a0;<xref rid="Fig2" ref-type="fig">2</xref>a). We also observed that models that assume larger pool sizes (<italic>K</italic>&#x0003e;8) tended to yield sparse solutions, which means that only the relevant subset of latent samples required to explain the data were used, indicating that the model is robust to choosing more samples than necessary during inference (Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S1).
<fig id="Fig2"><label>Fig. 2</label><caption><p>Evaluation of Vireo using synthetic mixtures of up to 16 scRNA-seq datasets, including a comparison to models that require genotype data of the pooled samples (Vireo-GT and Demuxlet). <bold>a</bold>&#x02013;<bold>c</bold> Assessment of Vireo performance on one representative simulated dataset consisting of 8 pooled samples with 1000 cells per sample, 8% doublet rate, and 4000 UMIs per cell on average. <bold>a</bold> Vireo model evidence (variational lower bound) when varying the pool size assumed in the model. <bold>b</bold> Adjusted Rand index (ARI) between the most likely inferred and the true singlet assignment, when varying the assignment confidence. The recommended cutoff (prob_max &#x0003e;0.9 for Vireo and Vireo-GT, and PRB.SNG1 &#x0003e;0.67 for Demuxlet) are highlighted as dot. <bold>c</bold> Receiver operating characteristic (ROC) curve for detecting doublets, when varying the assignment confidence. The recommended cutoff (prob_doublet &#x0003e;0.9 for Vireo and Vireo-GT, and 0.67 for Demuxlet) are highlighted with dots. <bold>d</bold>&#x02013;<bold>i</bold> Systematic assessment of Vireo and alternative methods on simulated data using a range of parameter choices, using five replicate runs. <bold>d</bold>&#x02013;<bold>f</bold> Area under ARI for singlet assignment considering alternative simulation settings, either varying the number of input samples <bold>d</bold>, the number of total cells in the dataset (doublet rate varied proportional; 1.2 to 12%; Methods) <bold>e</bold>, as well as the number of UMIs per cell <bold>f</bold>. <bold>g</bold>-<bold>i</bold> Area under the ROC for doublet detection, considering the same simulation parameters as in panels <bold>d</bold>&#x02013;<bold>f</bold>. Parameters not varied in either of these experiments were set to their default values (indicated by the star symbol). Small dots in each experiment denote the five replicate simulation experiments, and the big dot denotes the median performance across replicates</p></caption><graphic xlink:href="13059_2019_1865_Fig2_HTML" id="MO2"/></fig></p><p>Next, we evaluated the performance of Vireo for singlet assignment and doublet detection, where for comparison we also considered alternative models that require full genotype data of the pooled samples (Demuxlet [<xref ref-type="bibr" rid="CR13">13</xref>] and Vireo-GT, i.e., Vireo with full genotype data; Methods). By measuring the adjusted Rand index (ARI) of the most likely assignment of singlet cells to samples with regard to the true assignments, we found that Vireo achieved markedly accurate results, yielding comparable performance as Vireo-GT and Demuxlet (Fig.&#x000a0;<xref rid="Fig2" ref-type="fig">2</xref>b). We also varied the assignment confidence (Methods), finding that all three methods achieve near-perfect assignments of the full set of singletons (recall = 1). In the following, we consider the area under the ARI-recall curve (AUC) as a measure to systematically assess the performance of singlet assignment across a wider range of settings.</p><p>Similar to Demuxlet, Vireo can also be used to identify doublet cells, provided that the doublets are formed of combinations of cells from two genetically distinct samples in the pool. Vireo without genotype achieves doublet detection with an overall AUC = 0.978 (98.7% sensitivity and 96.7% specificity at prob_doublet &#x0003e;0.9, Fig.&#x000a0;<xref rid="Fig2" ref-type="fig">2</xref>c), which is only marginally lower than the performance achieved when using genotype data (Vireo-GT or Demuxlet, both AUC &#x02248;0.995). In practice, and in the experiments reported below, we recommend prob_max &#x0003e;0.9 as the threshold for the singlet assignment, and prob_doublet &#x0003e;0.9 for the detection of doublets (see Methods).</p><p>Exploring a wider range of settings, we also evaluated the model when varying the number of multiplexed samples (Fig.&#x000a0;<xref rid="Fig2" ref-type="fig">2</xref>d, g), the number of cells assayed in each experiment (Fig.&#x000a0;<xref rid="Fig2" ref-type="fig">2</xref>e, h), and the number of UMIs per cell (Fig.&#x000a0;<xref rid="Fig2" ref-type="fig">2</xref>f, i). As expected, the cell-assignment accuracy decreased with increasing numbers of samples in the pool, but Vireo retained high accuracy for up to 12 multiplexed samples (Fig.&#x000a0;<xref rid="Fig2" ref-type="fig">2</xref>d, g). Beyond 12 samples, there is a risk that the Vireo solution represents a local optimum of the variational lower bound, omitting one or multiple samples present in the pool (Fig.&#x000a0;<xref rid="Fig2" ref-type="fig">2</xref>d). Using current experimental technologies, however, such high multiplexes are not commonly considered, as the necessary cell counts are associated with greatly increased doublet rates (e.g., on the 10x Chromium platform). Conversely, the accuracy of cell-assignment was consistently high across a large range of cell counts per sample (Fig.&#x000a0;<xref rid="Fig2" ref-type="fig">2</xref>e), where larger numbers of cells tended to result in increased accuracy. Similarly, increasing the sequencing coverage resulted in improved accuracy for doublet detection (Fig.&#x000a0;<xref rid="Fig2" ref-type="fig">2</xref>i), whereas accurate singleton assignments were achieved even with extremely low UMI counts per cell (Fig.&#x000a0;<xref rid="Fig2" ref-type="fig">2</xref>f).</p><p>Next, we assessed the utility of partial genotype data for a subset of samples in the pool, which as expected increased the model performance, particularly in settings with low sequencing coverage (1200 UMIs per cell, Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S2). We also evaluated the robustness of Vireo when applying the model to biased pools of samples, i.e., settings in which some samples contribute a smaller than expected fraction of cells. Vireo robustly detected and aligned cells to samples with a relative frequency as low as 10% (Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S3), while retaining high accuracy for doublet detection. However, rare samples that were represented by fewer than 100 cells could be be missed in some settings.</p><p>Finally, we assessed the accuracy of the genotype reconstruction of the pooled samples, finding that Vireo implicitly provides accurate genotype information for expressed variants (10 or more UMIs) detected in the scRNA-seq data (overall precision &#x0003e;0.96, with heterozygous sites of lowest precision = 0.91; Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S4). Although such estimated genotypic states are intrinsically not available genome-wide, these partial genotype profiles can be used as a linking key to align the reconstructed samples to other omics data or to combine demultiplexed datasets across experiments (Methods).</p></sec><sec id="Sec4"><title>Application to real pooled data</title><p>Next, we applied Vireo to two real datasets that have previously been considered to benchmark demultiplexing methods that require genotype information for all samples [<xref ref-type="bibr" rid="CR13">13</xref>].</p><p>First, we considered a set of three multiplexed experiments (Fig.&#x000a0;<xref rid="Fig3" ref-type="fig">3</xref>a-c; W1-W3, between 3639 and 6145 cells) of peripheral blood mononuclear cells (PBMCs) from eight lupus patients. We applied Vireo without using genotype information to all cells across these three batches (Methods), thereby also creating an implicit link across all the three experiments. The Vireo cell assignments were markedly consistent with the assignments obtained when using Demuxlet, which, however, relies crucially on genotype data for all samples (Fig.&#x000a0;<xref rid="Fig3" ref-type="fig">3</xref>a). Similarly, we observed overall concordant doublet cell assignments, although there were larger differences than for singlet assignments (Fig.&#x000a0;<xref rid="Fig3" ref-type="fig">3</xref>b). We also applied Vireo separately to each of the three datasets and used the inferred genotype state of the samples to link the sample identity across experiments retrospectively (Fig.&#x000a0;<xref rid="Fig3" ref-type="fig">3</xref>c). This result demonstrates the utility of the inferred genotype data for integrating demultiplexed samples across experiments, and shows how the inferred genotypes can also be used to link demultiplexed scRNA-seq samples to other (sequencing-based) assay data available from the same samples (Methods).
<fig id="Fig3"><label>Fig. 3</label><caption><p>Evaluation of Vireo on data from multiplexed human PBMCs. <bold>a</bold>&#x02013;<bold>c</bold> Results obtained on two datasets consisting of two pools of 4 samples each, as well as a third dataset consisting of the union of all 8 samples. <bold>a</bold> Concordance of singlet assignment and doublet detection between Vireo without genotype data and Demuxlet applied with complete genotype reference. Bars denote the number of cells assigned to each sample, either considering cells that were consistently assigned by both Vireo and Demuxlet (blue), or assigned exclusively by Vireo (green) or Demuxlet (red). <bold>b</bold> Concordance of doublet detection between Vireo and Demuxlet when varying the assignment threshold for each method. Note, p denotes the threshold prob_doublet in Vireo (<italic>x</italic>-axis) and Demuxlet (<italic>y</italic>-axis) respectively, and n denotes the number of detected doublets. Assignment of cells in <bold>a</bold> is based on the most probable sample assignment, considering all cells that were not detected as doublet. Cells with a doublet probability (p_doublet &#x0003e;0.9 in Vireo; &#x0003e;2/3 in Demuxlet) were labelled as doublet cells and are considered in <bold>b</bold>. <bold>c</bold> Alignment of samples, when applying Vireo separately to the three datasets considered in <bold>a</bold>. Values in the heatmap denote the fraction of concordant genotype states between pairs of samples from both Vireo runs, considering variants with a read coverage of at least 10 UMIs per sample. <bold>d</bold>&#x02013;<bold>f</bold> Results from a second experiment, consisting of two datasets with the same 8 samples pooled in two different conditions: unstimulated and stimulated. Results shown correspond to the panels in <bold>a</bold>&#x02013;<bold>c</bold></p></caption><graphic xlink:href="13059_2019_1865_Fig3_HTML" id="MO3"/></fig></p><p>As a second use case, we considered two experiments of PBMCs from the same eight patients: one batch with IFN- <italic>&#x003b2;</italic> stimulation and a matched control experiment without stimulus. Cells were cultured for 6 h after pooling, which, in contrast to the first dataset, resulted in an imbalanced distribution of cells across samples (Fig.&#x000a0;<xref rid="Fig3" ref-type="fig">3</xref>d). Despite this distributional bias, Vireo again yielded demultiplexing results that were markedly consistent with the results obtained by methods that require a genotype reference (Fig.&#x000a0;<xref rid="Fig3" ref-type="fig">3</xref>d, e), and Vireo enabled aligning samples across both experiments (Fig.&#x000a0;<xref rid="Fig3" ref-type="fig">3</xref>f).</p></sec><sec id="Sec5"><title>Leveraging multiplexed designs for differential expression analysis</title><p>Finally, we considered the demultiplexed dataset consisting of stimulated and unstimulated cells (Fig.&#x000a0;<xref rid="Fig3" ref-type="fig">3</xref>d&#x02013;f) to explore the utility of multi-sample designs for differential gene expression analysis. Graph-based clustering (implemented in Scanpy [<xref ref-type="bibr" rid="CR20">20</xref>]) applied to the joint dataset consisting of stimulated and unstimulated cells from all eight samples (Fig.&#x000a0;<xref rid="Fig4" ref-type="fig">4</xref>c) identified eight major clusters, which could be annotated by common cell types (Fig.&#x000a0;<xref rid="Fig4" ref-type="fig">4</xref>a-b; Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S5). Next, we tested for differential gene expression between the stimulated and unstimulated condition within each cell type (using edgeR, considering cells as replicates [<xref ref-type="bibr" rid="CR21">21</xref>]). Considering B cells as a representative example (see Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S8&#x02013;S11 for full results), this analysis identified between 78 and 477 DE genes in individual samples (FDR &#x0003c;5%; Fig.&#x000a0;<xref rid="Fig4" ref-type="fig">4</xref>f), with cell count being a major explanatory factor for differences in the number of DE genes (Fig.&#x000a0;<xref rid="Fig4" ref-type="fig">4</xref>c). Although globally, DE genes tended to be recurrently detected in multiple samples (Fig.&#x000a0;<xref rid="Fig4" ref-type="fig">4</xref>e), there was a substantial fraction of DE genes that were private to individual samples. For example, the gene OAZ1 (Fig.&#x000a0;<xref rid="Fig4" ref-type="fig">4</xref>d) was differentially expressed in four of eight samples, highlighting the relevance of inter-individual differences (more examples in Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S6). We also explored carrying out joint testing across all samples (using samples as an explanatory factor in the model in edgeR; Methods), which led to broadly similar conclusions (Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S7).
<fig id="Fig4"><label>Fig. 4</label><caption><p>Case study of differential expression analysis of INF- <italic>&#x003b2;</italic> stimulated PBMCs using two matched pools that consist of 8 samples. <bold>a</bold> UMAP representation of single-cell transcriptome profiles, colored by eight major cell types identified. Note, M denotes Monocytes. <bold>b</bold> Analogous UMAP representation colored by the experimental condition: stimulated versus unstimulated. <bold>c</bold> The number of stimulated and unstimulated B cells sequenced in each of the 8 samples. <bold>d</bold>&#x02013;<bold>f</bold> Differential gene expression (DE) analysis between stimulated and unstimulated B cells. <bold>d</bold> The expression level of an example gene OAZ1, depicting the distribution of expression levels in both conditions, either considering each sample separately (S1..S8) or considering aggregated data pooled across all samples (All). FDR: adjusted P value (Benjamini-Hochberg) of each DE test between conditions with likelihood-ratio test. CPM: count per million. <bold>e</bold> Number of recurrently detected DE genes between conditions (FDR &#x0003c;0.05), detected in at least one to eight samples. Box plots in gray show the recurrence expected by chance (based on 200 permutations). <bold>f</bold> The number of DE genes in each of the 8 samples, categorized by the number of recurrent DE discoveries across samples, that is the number of individuals in which a given gene is identified as DE (FDR &#x0003c;0.05)</p></caption><graphic xlink:href="13059_2019_1865_Fig4_HTML" id="MO4"/></fig></p></sec></sec><sec id="Sec6" sec-type="conclusion"><title>Conclusion</title><p>Here, we have presented Vireo, a Bayesian method for demultiplexing pooled single-cell RNA-seq datasets by exploiting natural genetic barcodes and cell genotyping based on scRNA-seq reads. Uniquely, Vireo does not require any reference genotype data of the specific samples that are pooled in the experiment, while achieving demultiplexing accuracies that are comparable to methods that require a genotype reference. Vireo is implemented using computationally efficient variational Bayesian inference, which provides a fully Bayesian treatment while retaining scalability to large datasets.</p><p>Using synthetic mixtures of cells, we have evaluated the accuracy of Vireo for demultiplexing pooled samples, and found it robust to a variety of settings. We also demonstrated the model&#x02019;s flexibility for handling partial genotype data for some of the samples, should these data be available. Unsurprisingly, we observed that the accuracy of the genotype estimation step per sample is primarily linked to the sequencing coverage, which also substantially affects the ability to detect doublet cells. As the exact requirements for the optimal sequence coverage depend on the cell count and the number of pooled samples, we provide a simulation framework that enables the user to explore parameters thereby aiding the experimental design of pooled studies. If cells from the same individuals are assayed in multiple batches, Vireo can also demultiplex them jointly, which boosts the assignment accuracy, especially in experiments with lower read coverage. Furthermore, the estimated genotypes for individual samples enable aligning samples from the scRNA-seq data with other &#x02019;omics data for the same samples (Fig.&#x000a0;<xref rid="Fig3" ref-type="fig">3</xref>c), which provides a flexible approach for linking samples across experiments, including multi-omics treatment-control designs.</p><p>We noticed that the accuracy of demultiplexing without a genotype reference starts to deteriorate for pools with more than 12 samples. Increased sequencing coverage may allow for demultiplexing even larger pools, but there remain general experimental limitations for such designs. In particular, as long as the doublet rates scales with increased cell count such designs remain of limited interest.</p><p>As future technologies that motivate even larger pool sizes become available, extensions of Vireo that can handle such settings may be warranted. Notably, the demultiplexing accuracy is also linked to read coverage per cell as well as total cell count, two characteristic quantities that are likely to improve as single-cell technologies continue to mature.</p><p>As a reference-free method, Vireo is particularly useful in settings where samples are treated as biological replicates and the primary object is the variation between samples or groups, which does not require the explicit identification of individual samples in the pool (Fig.&#x000a0;<xref rid="Fig3" ref-type="fig">3</xref> and <xref rid="Fig4" ref-type="fig">4</xref>). Beyond that, Vireo has the intrinsic limitation that the inferred samples cannot be directly identified or linked to metadata. However, when the necessity for sample identity arises, the estimated genotype states are readily available for linking the samples to other &#x02019;omics data, e.g., other scRNA-seq batches (Fig.&#x000a0;<xref rid="Fig3" ref-type="fig">3</xref>c, f) or bulk RNA-seq (Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S12). These principles can be applied to any read-based assay, which provides genotypes. Finally, it is straightforward to generate targeted qPCR-based genotypes for a minimal set of discriminatory variants (Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S13). The Vireo software provides helper functions for designing such experiments, which directly leverages the reconstructed genotypes in the pool to define a small set of discriminatory variants (Methods). Vireo may also prove suitable for demultiplexing pooled samples for other read-based single-cell assays such as single-cell ATAC-seq, but further benchmarking on appropriate datasets would be needed and was not explored in this work.</p><p>Molecular barcoding strategies, e.g., [<xref ref-type="bibr" rid="CR9">9</xref>&#x02013;<xref ref-type="bibr" rid="CR12">12</xref>], have recently emerged as an alternatives to genetic barcoding in many respects courtesy of their more universal applicability. For example, molecular barcoding enables pooling multiple treatment conditions or tissues from the same individual or from individuals with the same genetic background (e.g., inbred model organisms). Nevertheless, natural genetic variants as barcode, which thanks to Vireo now can be applied even when no genotype data are available, have the advantage of avoiding additional laboratory work, thus reducing the logistical complexity, which can impact cost, processing efficiency and data quality.</p></sec><sec id="Sec7"><title>Methods</title><sec id="Sec8"><title>Vireo model</title><p>Given a list of <italic>N</italic> common variants, we extract allelic expression of these variants in each of <italic>M</italic> cells with RNA-seq data (see below for details on the read pileup approach for variant genotyping). Let <italic>A</italic> and <italic>D</italic> respectively denote the read or UMI count matrices for the alternative allele (i.e., ALT) and the total read depth (i.e., sum of ALT and REF) for <italic>N</italic> variants across <italic>M</italic> cells. Vireo models variation in these counts matrices by employing a clustering model with clusters corresponding to <italic>K</italic> individuals in the pool, with (unknown) genotype states <italic>G</italic>. The values of <italic>G</italic> take on values of 0, 1, or 2, corresponding to homozygous REF, heterozygous and homozygous ALT alleles.</p><p>The observed alternative allele counts <italic>A</italic> are modelled as binomial distributed given the read depths
<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ p(a_{i,j}|d_{i,j}, \theta_{t}) = \text{\texttt{Binom}}(a_{i,j}|d_{i,j}, \theta_{t}), t \in T = \{0, 1, 2\},   $$ \end{document}</tex-math><mml:math id="M2"><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b8;</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mtext>Binom</mml:mtext><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b8;</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>&#x02208;</mml:mo><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>}</mml:mo><mml:mo>,</mml:mo></mml:math><graphic xlink:href="13059_2019_1865_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p><p>where <italic>t</italic> is the true genotype of variant <italic>i</italic> in cell <italic>j</italic>, and <italic>&#x003b8;</italic><sub><italic>t</italic></sub> is the binomial rate parameter that encodes the corresponding allele dosage of the alternative allele for genotype <italic>t</italic>. Theoretically, the allele dosage is <italic>&#x003b8;</italic><sub><italic>t</italic></sub>=<italic>t</italic>/2, whereas in practice we allow for deviations to account for sequencing errors, genotype estimation errors, and allelic imbalance.</p><p>The genotype in a given cell is defined by a clustering model where the latent genotype <italic>t</italic> for variant <italic>i</italic> in cell <italic>j</italic> is coded by two indicator variables: the cell assignment vector <italic>Z</italic><sub><italic>j</italic></sub>, which assigns cell <italic>j</italic> to a latent sample in the pool, and the genotype identity <italic>G</italic><sub><italic>i,k</italic></sub>, which defines the allelic state of variant <italic>i</italic> in sample <italic>k</italic>. Specifically, the indicator variable <italic>Z</italic><sub><italic>j,k</italic></sub>=1 if cell <italic>j</italic> is assigned to sample <italic>k</italic> and 0 otherwise; we also impose the constraint <inline-formula id="IEq1"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\sum _{k} {Z_{j,k}} = 1$\end{document}</tex-math><mml:math id="M4"><mml:munder><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="13059_2019_1865_Article_IEq1.gif"/></alternatives></inline-formula>, which means that in expectation each cell originates from exactly one sample. Analogously, the indicator variable <italic>G</italic><sub><italic>i,k</italic>,<italic>t</italic></sub>=1 if the genotype of variant <italic>i</italic> in sample <italic>k</italic> is <italic>t</italic>, and 0 otherwise, and we again require <inline-formula id="IEq2"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\sum _{t} {G_{i,k,t}} = 1$\end{document}</tex-math><mml:math id="M6"><mml:munder><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="13059_2019_1865_Article_IEq2.gif"/></alternatives></inline-formula>. The cell assignment matrix <italic>Z</italic> is strictly unknown and needs to be estimated from the observed data. In general, the genotype matrix <italic>G</italic> is also unknown and is estimated jointly with <italic>Z</italic>. If genotype information is available for one or multiple samples in the pool, this information can be encoded as an informative prior on <italic>G</italic>; see below.</p><p>The likelihood of the full datasets, spanning all <italic>N</italic> variants that were genotyped in each of <italic>M</italic> cells given the cell assignment matrix <italic>Z</italic>, the genotype matrix <italic>G</italic> and binomial parameter <bold><italic>&#x003b8;</italic></bold> follows as:
<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ p(A, D | Z, G, \boldsymbol\theta) = \prod_{i=1}^{N} \prod_{j=1}^{M} \prod_{k=1}^{K}\prod_{t\in T} p(a_{i,j}|d_{i,j}, \theta_{t})^{Z_{j,k} \times G_{i,k,t}}   $$ \end{document}</tex-math><mml:math id="M8"><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>D</mml:mi><mml:mo>|</mml:mo><mml:mi>Z</mml:mi><mml:mo>,</mml:mo><mml:mi>G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mrow><mml:mo>&#x0220f;</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:munderover><mml:mrow><mml:mo>&#x0220f;</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:munderover><mml:mrow><mml:mo>&#x0220f;</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mo>&#x0220f;</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>&#x02208;</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:munder><mml:mi>p</mml:mi><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b8;</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>&#x000d7;</mml:mo><mml:msub><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math><graphic xlink:href="13059_2019_1865_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p><p>To complete the definition of the model, we introduce prior distributions on the latent variables, which results in the following joint distribution over both observed and latent variables
<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ p(A, D, Z, G, \boldsymbol\theta) = p(A, D | Z, G, \boldsymbol\theta) p(Z|\boldsymbol\pi) p(G|U) p(\boldsymbol\theta | \boldsymbol\alpha, \boldsymbol\beta)   $$ \end{document}</tex-math><mml:math id="M10"><mml:mspace width="-12.0pt"/><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>D</mml:mi><mml:mo>,</mml:mo><mml:mi>Z</mml:mi><mml:mo>,</mml:mo><mml:mi>G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>D</mml:mi><mml:mo>|</mml:mo><mml:mi>Z</mml:mi><mml:mo>,</mml:mo><mml:mi>G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi><mml:mo>)</mml:mo><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>Z</mml:mi><mml:mo>|</mml:mo><mml:mi mathvariant="bold-italic">&#x003c0;</mml:mi><mml:mo>)</mml:mo><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>G</mml:mi><mml:mo>|</mml:mo><mml:mi>U</mml:mi><mml:mo>)</mml:mo><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi><mml:mo>|</mml:mo><mml:mi mathvariant="bold-italic">&#x003b1;</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">&#x003b2;</mml:mi><mml:mo>)</mml:mo></mml:math><graphic xlink:href="13059_2019_1865_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula></p><p>For computational convenience, we use conjugate prior distributions, namely a beta distribution for <bold><italic>&#x003b8;</italic></bold> and multinomial distributions for both <italic>Z</italic> and <italic>G</italic>.
<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \begin{aligned} p(Z_{j,k} = 1|\boldsymbol\pi) &#x00026; = \text{\texttt{Multinom}}(\boldsymbol\pi) = \pi_{k} \\ p(G_{i,k,t} = 1|U) &#x00026; = \text{\texttt{Multinom}}(\boldsymbol{u}_{i,k}) = u_{i,k,t} \\ p(\theta_{t} | \alpha_{t}^{(0)}, \beta_{t}^{(0)}) &#x00026; = \text{\texttt{beta}} \left(\theta_{t}| \alpha_{t}^{(0)}, \beta_{t}^{(0)}\right) \end{aligned}  $$ \end{document}</tex-math><mml:math id="M12"><mml:mtable><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:mi mathvariant="bold-italic">&#x003c0;</mml:mi><mml:mo>)</mml:mo></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:mtext>Multinom</mml:mtext><mml:mo>(</mml:mo><mml:mi mathvariant="bold-italic">&#x003c0;</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003c0;</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:mi>U</mml:mi><mml:mo>)</mml:mo></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:mtext>Multinom</mml:mtext><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b8;</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>)</mml:mo></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:mtext>beta</mml:mtext><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>&#x003b8;</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2019_1865_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p><p>The hyper parameters are constant and set as follows. We use an uninformative prior for <italic>Z</italic>: <italic>&#x003c0;</italic><sub><italic>k</italic></sub>=1/<italic>K</italic>, which corresponds to a uniform assignment probability of cells to samples. The user can define other multinomial probabilities, for example to encode known bias in the sample representation. Similarly, we employ a uniform prior on genotype <italic>G</italic>, i.e., <italic>u</italic><sub><italic>i,j</italic>,<italic>t</italic></sub>=1/3 if no genotype data are available. If the genotypes are partially known for a subset of samples and/or variants, a corresponding informative prior is encoded. Specifically, <italic>u</italic><sub><italic>i,j</italic>,<italic>t</italic></sub> takes the known genotype value with a relax rate <italic>&#x003be;</italic>, i.e., <italic>u</italic><sub><italic>i,j</italic>,<italic>t</italic></sub>=1&#x02212;<italic>&#x003be;</italic> if the known genotype is <italic>t</italic>, otherwise <italic>u</italic><sub><italic>i,j</italic>,<italic>t</italic></sub>=<italic>&#x003be;</italic>. The error rate parameter is set to <italic>&#x003be;</italic>=0.05 by default.</p><p>Finally, the hyper parameter for the beta prior on the allelic rate <bold><italic>&#x003b8;</italic></bold> is determined using known germline variants with high coverage: <italic>&#x003b8;</italic><sub>0</sub>&#x0223c;beta(0.3,29.7),<italic>&#x003b8;</italic><sub>1</sub>&#x0223c;beta(3,3), and <italic>&#x003b8;</italic><sub>2</sub>&#x0223c;beta(29.7,0.3), with which the posterior of <bold><italic>&#x003b8;</italic></bold> will be obtained by fitting to the dataset.</p></sec><sec id="Sec9"><title>Variational Bayesian inference</title><p>Analytical calculation of the posterior distribution of all latent variables given the observed data <italic>p</italic>(<italic>Z,G</italic>,<bold><italic>&#x003b8;</italic></bold>|<italic>A,D</italic>) is not tractable. Thus, we consider variational Bayesian inference [<xref ref-type="bibr" rid="CR22">22</xref>] to obtain an approximate solution, thereby retaining the benefits of a Bayesian treatment while achieving computational scalability to larger scRNA-seq datasets. Briefly, the objective of variational inference is to approximate the exact (intractable) posterior distribution of the latent variables <italic>p</italic>(<bold>Y</bold>|<bold>X</bold>) by a factorized distribution <inline-formula id="IEq3"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$q(\mathbf {Y}) = \prod _{i} q_{i}({Y}_{i})$\end{document}</tex-math><mml:math id="M14"><mml:mi>q</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo>&#x0220f;</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:math><inline-graphic xlink:href="13059_2019_1865_Article_IEq3.gif"/></alternatives></inline-formula>, where <bold>Y</bold> denotes a set of latent variables and <bold>X</bold> denotes the observed variables. The parameters of the variational distribution <italic>q</italic>(<bold>Y</bold>) are determined with the objective to minimize the Kullback-Leibler <inline-formula id="IEq4"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$(\mathcal {KL})$\end{document}</tex-math><mml:math id="M16"><mml:mo>(</mml:mo><mml:mi mathvariant="script">K</mml:mi><mml:mi mathvariant="script">&#x02112;</mml:mi><mml:mo>)</mml:mo></mml:math><inline-graphic xlink:href="13059_2019_1865_Article_IEq4.gif"/></alternatives></inline-formula> divergence between the approximate distribution <italic>q</italic>(<bold>Y</bold>) and the actual posterior distribution <italic>p</italic>(<bold>Y</bold>|<bold>X</bold>)
<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \mathcal{KL}(q(\mathbf{Y})||p(\mathbf{Y}|\mathbf{X})) = \int{ q(\mathbf{Y}) \log\frac{q(\mathbf{Y})}{p(\mathbf{Y}|\mathbf{X})}} \mathrm{d}\mathbf{Y}.   $$ \end{document}</tex-math><mml:math id="M18"><mml:mi mathvariant="script">K</mml:mi><mml:mi mathvariant="script">&#x02112;</mml:mi><mml:mo>(</mml:mo><mml:mi>q</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>)</mml:mo><mml:mo>|</mml:mo><mml:mo>|</mml:mo><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>|</mml:mo><mml:mi mathvariant="bold">X</mml:mi><mml:mo>)</mml:mo><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mo>&#x0222b;</mml:mo><mml:mi>q</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>)</mml:mo><mml:mo>log</mml:mo><mml:mfrac><mml:mrow><mml:mi>q</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>|</mml:mo><mml:mi mathvariant="bold">X</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="bold">Y</mml:mi><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2019_1865_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula></p><p>This objective is equivalent to maximizing the lower bound of the full distribution L(<italic>q</italic>), as the log marginal probability of the observed variables is a constant, as follows,
<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \log(p(X)) = \text{\texttt{L}}(q) + \mathcal{KL}\left(q(\mathbf{Y})||p(\mathbf{Y}|\mathbf{X})\right),  $$ \end{document}</tex-math><mml:math id="M20"><mml:mo>log</mml:mo><mml:mo>(</mml:mo><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>X</mml:mi><mml:mo>)</mml:mo><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>q</mml:mi><mml:mo>)</mml:mo><mml:mo>+</mml:mo><mml:mi mathvariant="script">K</mml:mi><mml:mi mathvariant="script">&#x02112;</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>q</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>)</mml:mo><mml:mo>|</mml:mo><mml:mo>|</mml:mo><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>|</mml:mo><mml:mi mathvariant="bold">X</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:math><graphic xlink:href="13059_2019_1865_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula></p><p>where the lower bound L(<italic>q</italic>) is defined as follows,
<disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \text{\texttt{L}}(q) = \int{ q(\mathbf{Y}) \log\frac{p(\mathbf{Y}, \mathbf{X})}{q(\mathbf{Y})}} \mathrm{d}\mathbf{Y}.  $$ \end{document}</tex-math><mml:math id="M22"><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>q</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mo>&#x0222b;</mml:mo><mml:mi>q</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>)</mml:mo><mml:mo>log</mml:mo><mml:mfrac><mml:mrow><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">X</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>q</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="bold">Y</mml:mi><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2019_1865_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula></p><p>A set of iterative update equations can be derived, which are guaranteed to increase the lower bound
<disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ q_{j}({Y}_{j}) = \frac{\exp\left\{\mathbb{E}_{i \neq j} \log\left(p(\mathbf{Y}, \mathbf{X})\right)\right\}} {\int{\exp\left\{\mathbb{E}_{i \neq j} \log\left(p(\mathbf{Y}, \mathbf{X})\right.\right\}}\mathrm{d}\mathbf{Y}_{j}}.  $$ \end{document}</tex-math><mml:math id="M24"><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>exp</mml:mo><mml:mfenced close="}" open="{" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">&#x1d53c;</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>&#x02260;</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>log</mml:mo><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">X</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>&#x0222b;</mml:mo><mml:mo>exp</mml:mo><mml:mfenced close="}" open="{" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">&#x1d53c;</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>&#x02260;</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>log</mml:mo><mml:mfenced close="" open="(" separators=""><mml:mrow><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">X</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mi mathvariant="normal">d</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2019_1865_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula></p><p>Here, <inline-formula id="IEq5"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathbb {E}_{i \neq j}$\end{document}</tex-math><mml:math id="M26"><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">&#x1d53c;</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>&#x02260;</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2019_1865_Article_IEq5.gif"/></alternatives></inline-formula> denotes an expectation with respect to the distributions <italic>q</italic><sub><italic>i</italic></sub>(<bold>Y</bold><sub><italic>i</italic></sub>) for all <italic>i</italic>&#x02260;<italic>j</italic>.</p><p>For inference in Vireo, we assume a fully factorized distribution <italic>q</italic>(<italic>Z,G</italic>,<bold><italic>&#x003b8;</italic></bold>)=<italic>q</italic>(<italic>Z</italic>)<italic>q</italic>(<italic>G</italic>)<italic>q</italic>(<bold><italic>&#x003b8;</italic></bold>) to approximate the true posterior distribution <italic>p</italic>(<italic>Z,G</italic>,<bold><italic>&#x003b8;</italic></bold>|<italic>A,D</italic>), and we assume that <italic>Z</italic> and <italic>G</italic> follow categorical distributions, and <bold><italic>&#x003b8;</italic></bold> follows beta distributions. Based on this assumption, the lower bound can be computed as in Eq. <xref rid="Equ7" ref-type="">7</xref> (See Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Supplementary Methods Equation (S1-6)). Following Eq. 8, it is possible to derive iterative update equations for the <italic>Q</italic> distribution of the latent variables (see Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Supplementary Methods Equation (S7-12) for full details).
<disp-formula id="Equ9"><label>9</label><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \begin{aligned} q^{*}(Z) &#x00026; = \prod_{j=1}^{M} \prod_{k=1}^{K} r_{j,k}^{Z_{j,k}};\\ r_{j,k} &#x00026;= \frac{\pi_{k}\exp \sum_{i=1}^{N} \sum_{t\in T} \left\{ \tilde g_{i,k,t} [a_{i,j}\varphi(\tilde\alpha_{t}) + b_{i,j}\varphi(\tilde\beta_{t})] \right\}} {\sum_{h=1}^{K} \pi_{h} \exp \sum_{i=1}^{N} \sum_{t\in T} \left\{ \tilde g_{i,h,t} [a_{i,j}\varphi(\tilde\alpha_{t}) + b_{i,j}\varphi(\tilde\beta_{t})] \right\}} \end{aligned}  $$ \end{document}</tex-math><mml:math id="M28"><mml:mtable><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mo>&#x02217;</mml:mo></mml:mrow></mml:msup><mml:mo>(</mml:mo><mml:mi>Z</mml:mi><mml:mo>)</mml:mo></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:munderover><mml:mrow><mml:mo>&#x0220f;</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:munderover><mml:mrow><mml:mo>&#x0220f;</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:msubsup><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mo>;</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>&#x003c0;</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>exp</mml:mo><mml:munderover><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>&#x02208;</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:munder><mml:mfenced close="}" open="{" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mi>&#x003c6;</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mi>&#x003c6;</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>]</mml:mo></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:munderover><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>&#x003c0;</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mo>exp</mml:mo><mml:munderover><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>&#x02208;</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:munder><mml:mfenced close="}" open="{" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mi>&#x003c6;</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mi>&#x003c6;</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>]</mml:mo></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2019_1865_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula></p><p>
<disp-formula id="Equ10"><label>10</label><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \begin{aligned} q^{*}(G) &#x00026;= \prod_{i=1}^{N} \prod_{k=1}^{K} \prod_{t\in T} g_{i,k,t}^{G_{i,k,t}};\\ g_{i,k,t} &#x00026;= \frac{u_{i,k,t}\exp \sum_{j=1}^{M} \left\{ \tilde r_{j,k} \left[a_{i,j}\varphi(\tilde\alpha_{t}) + b_{i,j}\varphi(\tilde\beta_{t})\right] \right\}} {\sum_{h\in T} u_{i,k,h} \exp \sum_{j=1}^{M} \left\{ \tilde r_{j,k} \left[a_{i,j}\varphi(\tilde\alpha_{h}) + b_{i,j}\varphi(\tilde\beta_{h})\right] \right\}} \end{aligned}  $$ \end{document}</tex-math><mml:math id="M30"><mml:mtable><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mo>&#x02217;</mml:mo></mml:mrow></mml:msup><mml:mo>(</mml:mo><mml:mi>G</mml:mi><mml:mo>)</mml:mo></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:munderover><mml:mrow><mml:mo>&#x0220f;</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:munderover><mml:mrow><mml:mo>&#x0220f;</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mo>&#x0220f;</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>&#x02208;</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:munder><mml:msubsup><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mo>;</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>exp</mml:mo><mml:munderover><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:mfenced close="}" open="{" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mi>&#x003c6;</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mi>&#x003c6;</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>&#x02208;</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mo>exp</mml:mo><mml:munderover><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:mfenced close="}" open="{" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mi>&#x003c6;</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mi>&#x003c6;</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2019_1865_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula>
</p><p>
<disp-formula id="Equ11"><label>11</label><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \begin{aligned} q^{*}(\boldsymbol\theta) &#x00026;= \prod_{t\in T} \text{\texttt{beta}}(\theta_{t} | \alpha_{t}, \beta_{t});\\ \alpha_{t} &#x00026; = \alpha_{t}^{(0)} + \sum_{i=1}^{N} \sum_{j=1}^{M} \sum_{k=1}^{K} \tilde r_{j,k} \tilde g_{i,k,t} a_{i,j}, \\ \beta_{t} &#x00026; = \beta_{t}^{(0)} + \sum_{i=1}^{N} \sum_{j=1}^{M} \sum_{k=1}^{K} \tilde r_{j,k} \tilde g_{i,k,t} b_{i,j} \end{aligned}  $$ \end{document}</tex-math><mml:math id="M32"><mml:mtable><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mo>&#x02217;</mml:mo></mml:mrow></mml:msup><mml:mo>(</mml:mo><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi><mml:mo>)</mml:mo></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo>&#x0220f;</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>&#x02208;</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:munder><mml:mtext>beta</mml:mtext><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b8;</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>;</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:munderover><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:munderover><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:munderover><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:munderover><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:munderover><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:munderover><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2019_1865_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula>
</p><p>Here, we introduce <italic>b</italic><sub><italic>i,j</italic></sub>=<italic>d</italic><sub><italic>i,j</italic></sub>&#x02212;<italic>a</italic><sub><italic>i,j</italic></sub> to simplify the notation and <italic>&#x003c6;</italic>(&#x000b7;) denotes the digamma function. To mitigate potential local optima, multiple random restarts are considered (default: 50 restarts) and the solution that maximizes the variational lower bound is selected. Thanks to our implementation with sparse matrix data structures and the support of multiple threads, the Vireo model is computationally efficient. On a laptop with 16 G memory and two 3.5-GHz CPUs, Vireo finishes a two-run estimation (see next section) in 6.7 min for 14,619 cells in an eight sample pool and 58.1 s for 6145 cells in another eight sample pool (results in Fig.&#x000a0;<xref rid="Fig3" ref-type="fig">3</xref>).</p></sec><sec id="Sec10"><title>Vireo with known genotype or partial genotype</title><p>Besides demultiplexing pooled scRNA-seq without any genotype information, Vireo is also able to leverage any available genotype information. In the case that the genotype is available for all pooled samples, we only use the variants with known genotype and set the genotype probability variable <italic>G</italic> as known and fixed, which can be derived from the GT tag (for categorical genotype), GP or GL tag (genotype probability or likelihood) in the VCF file. By default, we use GT as it is the most commonly available tag.</p><p>Alternatively, Vireo also supports the use of any partial genotypes via a two-step run approach. In the first run, Vireo does not use any genotype information but infers the genotype for each sample. Then, we align the samples with known genotype to these identified samples in this run and replace the estimated genotype probability with the input known values. Therefore, we obtain a genotype probability matrix with mixed known and inferred samples, which we then use as a prior of <italic>G</italic>, instead of the default uniform prior in the second run. Finally, we report the results of the second run as the result of Vireo.</p></sec><sec id="Sec11"><title>Estimation of the number of pooled samples</title><p>Access to the variational lower bound (Eq. <xref rid="Equ7" ref-type="">7</xref>) allows for estimating the number of samples in a given pool. Briefly, by comparing alternative Vireo runs with increasing numbers of samples it is possible to identify the most probable value with the elbow plot (e.g., Fig.&#x000a0;<xref rid="Fig2" ref-type="fig">2</xref>a), which provides an objective means to define this parameter.</p><p>A second strategy is to set a large number of samples and prune some of the samples post hoc, as the variational Bayes model is self-regularizing and hence avoids over-fitting (see Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S1). In practice this approach can also increase robustness as the effective number of samples in a pool can be larger than anticipated due to doublets; see Section below.</p></sec><sec id="Sec12"><title>Multiple random initializations</title><p>When genotype is not given, Vireo uses a pre-step with multiple random initializations to avoid local optima. By default, Vireo runs for 50 random initializations, each with a short iterations (15 by default). Then the initialization with highest log likelihood will be continued.</p><p>As discussed in the above subsection, another strategy to find all <italic>K</italic> pooled samples is searching from a larger number of clusters. By default, we search <inline-formula id="IEq6"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$K + \sqrt {K}$\end{document}</tex-math><mml:math id="M34"><mml:mi>K</mml:mi><mml:mo>+</mml:mo><mml:msqrt><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:msqrt></mml:math><inline-graphic xlink:href="13059_2019_1865_Article_IEq6.gif"/></alternatives></inline-formula> clusters in this pre-step, and only keep the <italic>K</italic> clusters with largest number of assigned cells to continue, and discarded the <inline-formula id="IEq7"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\sqrt {K}$\end{document}</tex-math><mml:math id="M36"><mml:msqrt><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:msqrt></mml:math><inline-graphic xlink:href="13059_2019_1865_Article_IEq7.gif"/></alternatives></inline-formula> smaller clusters.</p></sec><sec id="Sec13"><title>Doublet detection</title><p>To detect doublets, we construct the genotype of each pair of samples and expand the <italic>K</italic> biological samples by introducing in additional (<italic>K</italic>&#x02212;1)&#x02217;<italic>K</italic>/2 doublet competitors. For simplicity, we assume that the genotype of a doublet sample can be described as the average between two combined samples. Specifically, for a given variant and genotype, probability vectors for two samples are <bold><italic>x</italic></bold>=[<italic>x</italic><sub>0</sub>,<italic>x</italic><sub>1</sub>,<italic>x</italic><sub>2</sub>] and <bold><italic>y</italic></bold>=[<italic>y</italic><sub>0</sub>,<italic>y</italic><sub>1</sub>,<italic>y</italic><sub>2</sub>], we define the expected genotype for the doublet sample as follows,
<disp-formula id="Equ12"><label>12</label><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \begin{aligned} p(t=0) &#x00026; = x_{0} y_{0} \\ p(t=1) &#x00026; = x_{1} y_{1} + x_{0} y_{2} + x_{2} y_{0} \\ p(t=2) &#x00026; = x_{2} y_{2} \\ p(t=0.5) &#x00026; = x_{0} y_{1} + x_{1} y_{0} \\ p(t=1.5) &#x00026; = x_{1} y_{2} + x_{2} y_{1} \end{aligned}  $$ \end{document}</tex-math><mml:math id="M38"><mml:mtable><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo>)</mml:mo></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0.5</mml:mn><mml:mo>)</mml:mo></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1.5</mml:mn><mml:mo>)</mml:mo></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2019_1865_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula></p><p>where we introduce two pseudo-genotypes <italic>t</italic>=0.5 and <italic>t</italic>=1.5 respectively for combinations of genotype 0 &#x00026; 1 and 1 &#x00026; 2 in the doublet sample. For convenience, we consider the binomial parameters for the alternative allelic reads and assume that the binomial parameters <italic>&#x003b8;</italic><sub>0.5</sub> and <italic>&#x003b8;</italic><sub>1.5</sub> also follow beta distributions. We approximate the hyper-parameters of the beta distribution empirically by respectively taking the ratio and shapes with the arithmetic and geometric means from the two ordinary genotypes. The resulting distribution of <italic>&#x003b8;</italic><sub>0.5</sub> can be expressed as follows
<disp-formula id="Equ13"><label>13</label><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \begin{aligned} p(\theta_{0.5}) &#x00026; = \text{\texttt{beta}}(\alpha_{0.5}, \beta_{0.5})\\ \frac{\alpha_{0.5}}{\alpha_{0.5} + \beta_{0.5}} &#x00026;= \frac{1}{2} \left(\frac{\alpha_{0}}{\alpha_{0} + \beta_{0}} + \frac{\alpha_{1}}{\alpha_{1} + \beta_{1}}\right)\\ (\alpha_{0.5} + \beta_{0.5})^{2} &#x00026;= (\alpha_{0} + \beta_{0}) \times (\alpha_{1} + \beta_{1}).\\ \end{aligned}  $$ \end{document}</tex-math><mml:math id="M40"><mml:mtable><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b8;</mml:mi></mml:mrow><mml:mrow><mml:mn>0.5</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:mtext>beta</mml:mtext><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mn>0.5</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mn>0.5</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mn>0.5</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mn>0.5</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mn>0.5</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mn>0.5</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mn>0.5</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>&#x000d7;</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mi>.</mml:mi></mml:mtd></mml:mtr><mml:mtr/></mml:mtable></mml:math><graphic xlink:href="13059_2019_1865_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula></p><p>Similarly, we define the distribution of <italic>&#x003b8;</italic><sub>1.5</sub>.</p><p>In this augmented model, we have the full distribution for the extended genotype reference <italic>G</italic> and <bold><italic>&#x003b8;</italic></bold>, consisting of <italic>K</italic> biological and (<italic>K</italic>&#x02212;1)&#x02217;<italic>K</italic>/2 doublet samples. In this model we can calculate the probability that a cell originates from one of the doublet samples using Eq. <xref rid="Equ9" ref-type="">9</xref>.</p><p>As an additional refinement, we specify a non-uniform prior on <italic>&#x003b7;</italic> to define the a priori belief of observing a doublet. Specifically, the prior binomial distribution <bold><italic>&#x003c0;</italic></bold> is constructed as follows
<disp-formula id="Equ14"><label>14</label><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ p(\pi_{h}) = \left\{\begin{array}{cc} (1 - \eta) / K, &#x00026; 1 \leq h \leq K; \text{(singlet)}\\ \eta / K_{2}, &#x00026; K &#x0003c; h \leq K + K_{2}; \text{(doublet)}\\ \end{array}\right.  $$ \end{document}</tex-math><mml:math id="M42"><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003c0;</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mfenced close="" open="{" separators=""><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>&#x02212;</mml:mo><mml:mi>&#x003b7;</mml:mi><mml:mo>)</mml:mo><mml:mo>/</mml:mo><mml:mi>K</mml:mi><mml:mo>,</mml:mo></mml:mtd><mml:mtd><mml:mn>1</mml:mn><mml:mo>&#x02264;</mml:mo><mml:mi>h</mml:mi><mml:mo>&#x02264;</mml:mo><mml:mi>K</mml:mi><mml:mo>;</mml:mo><mml:mtext>(singlet)</mml:mtext></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>&#x003b7;</mml:mi><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mtd><mml:mtd><mml:mi>K</mml:mi><mml:mo>&#x0003c;</mml:mo><mml:mi>h</mml:mi><mml:mo>&#x02264;</mml:mo><mml:mi>K</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>;</mml:mo><mml:mtext>(doublet)</mml:mtext></mml:mtd></mml:mtr><mml:mtr/></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2019_1865_Article_Equ14.gif" position="anchor"/></alternatives></disp-formula></p><p>where <italic>K</italic><sub>2</sub>=(<italic>K</italic>&#x02212;1)&#x000d7;<italic>K</italic>/2 as number of the combined sample pairs. The prior probability for doublet cells is low in most assays, e.g., <italic>&#x003b7;</italic>=0.05. In case of the 10x Chromium platform, the prior value can be estimated as a function of the number of loaded cells <italic>M</italic>, e.g., <italic>&#x003b7;</italic>=<italic>M</italic>/100,000 following [<xref ref-type="bibr" rid="CR13">13</xref>], which by default is used in our experiments.</p><p>Therefore, we can obtain the posterior of each cell&#x02019;s sample identity, i.e., the probability of cell <italic>j</italic> coming from any of the <italic>K</italic> input samples or <italic>K</italic><sub>2</sub> combined sample pairs (i.e., doublet). We use the highest assignment probability of the <italic>K</italic> input samples, prob_max, as the confidence score for singlet assignment and use the summarized probability of all <italic>K</italic><sub>2</sub> sample pairs as the confidence score of a doublet, namely prob_doublet.</p></sec><sec id="Sec14"><title>Alignment of samples between multiple data sets</title><p>Vireo implicitly estimates the genotypes for the subset of variants with sufficient coverage (good accuracy for variants with &#x0003e;10 reads per sample; see Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S4). Among other use cases, these estimated genotypes allow for aligning scRNA-seq profiles from samples in a pool to other &#x02019;omics data by matching genotype profiles.</p><p>When Vireo is applied to multiple data sets that consist of the same samples, the estimated genotype also allows for aligning samples across data sets (e.g., Fig.&#x000a0;<xref rid="Fig3" ref-type="fig">3</xref>c, f for multiple pools, and Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S12 for multiple &#x02019;omics). The software implementation of Vireo provides support functions for this step by calculating the fraction of variants with matched genotype between two or multiple experiments.</p></sec><sec id="Sec15"><title>Identification of discriminatory variants</title><p>Given a set of variants for which estimated genotypes are available, the Vireo software implements a heuristic to define a minimal and informative set of discriminatory variants. This set of variants can be used to perform qPCR-based genotyping or for other targeted genoytping methods. Briefly, the algorithm implemented in Vireo prioritizes variants with largest information gain in splitting samples, as follows.
<list list-type="order"><list-item><p>Remove variants with &#x0003c;20 UMIs per sample.</p></list-item><list-item><p>Initialize the variant set <italic>S</italic>={}, and the split <italic>T</italic> among <italic>K</italic> samples, and calculate the initial entropy <italic>H</italic>(<italic>T</italic>)=0</p></list-item><list-item><p>Rank variants by the information gain <italic>IG</italic>(<italic>T,v</italic>)=<italic>H</italic>(<italic>T</italic>)&#x02212;<italic>H</italic>(<italic>T</italic>|<italic>v</italic>)</p></list-item><list-item><p>Select the variant with highest information gain and update <italic>S</italic>, <italic>T</italic>, and <italic>H</italic>(<italic>T</italic>)</p></list-item><list-item><p>If <italic>H</italic>(<italic>T</italic>)= log2(<italic>K</italic>), return <italic>S</italic> and <italic>T</italic>, otherwise go to step 3.</p></list-item></list></p><p>Additionally, variants with homozygous alternative alleles in the pooled samples can also be filtered out before hand if needed. Examples of discriminatory variant sets for the six-sample pool from HipSci project are shown in Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S13.</p></sec><sec id="Sec16"><title>Differential expression analysis</title><p>Differential expression analysis was performed with edgeR [<xref ref-type="bibr" rid="CR21">21</xref>] between stimulated and control samples (Fig.&#x000a0;<xref rid="Fig4" ref-type="fig">4</xref> and Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S7&#x02013;S11). A generalized linear model (negative binomial regression) is applied in edgeR to test whether the stimulation contributes to the expression variation on a certain gene by using a likelihood-ratio test. Using the raw UMI counts as input to edgeR, we performed cell type specific DE analysis with the following three different strategies for all cells jointly (Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S7).</p><p>Method 1: <italic>y</italic>&#x0223c;cdr+condition+sample, where <italic>y</italic> is the expression count for a specific gene, which is regressed on three covariates: cdr, the cell detection rate (i.e., the fraction of expressed gene in each cell), stimulation condition and the sample identity.</p><p>Methods 2 and 3: <italic>y</italic>&#x0223c;cdr+condition, where we ignore the sample identity of each cell in the pool (Method 2). This same model can also be used in a pseudo-bulk manner where we aggregate the counts for all cells of the same type in a sample (Method 3). Alternatively, we can always apply this model at single-cell level for each sample separately (Fig.&#x000a0;<xref rid="Fig4" ref-type="fig">4</xref>d-f).</p></sec><sec id="Sec17"><title>ScRNA-seq data from Demuxlet paper</title><p>In this study, we considered two existing multiplexed scRNA-seq datasets that consist of a total of five batches [<xref ref-type="bibr" rid="CR13">13</xref>]. Raw.bam files were obtained from the Gene Expression Omnibus (GEO; accession number GSE96583). The processed results from Demuxlet for these five batches were directly downloaded from <ext-link ext-link-type="uri" xlink:href="https://github.com/yelabucsf/demuxlet_paper_code">https://github.com/yelabucsf/demuxlet_paper_code</ext-link>. Approximately 37 million common variants (allele frequency &#x0003e;0.0005) extracted from the 1000 Genome Project, phase 3 [<xref ref-type="bibr" rid="CR18">18</xref>] were used as candidate variants for scRNA-seq genotyping. We provide an companion Python package cellSNP [<xref ref-type="bibr" rid="CR23">23</xref>] for this task, which enables generating selected pile-ups from scRNA-seq data. We discarded non-bi-allelic variants as well as variants with fewer than 20 total UMIs across all cells or minor (i.e., second) allele has less than 10% of total UMIs. The final outputs of cellSNP are two variants-by-cells matrices, <italic>A</italic> and <italic>D</italic>, for UMI counts of alternative allele and the total counts respectively, which are used as input for the Vireo model.</p></sec><sec id="Sec18"><title>Bulk RNA-seq and scRNA-seq from HipSci project</title><p>In order to link the inferred samples to other &#x02019;omics data, we used one scRNA-seq pool for iPSC differentiation in the HipSci project (10x Genomics platform, experiment 44, day 0) with six samples: <italic>pipw</italic>, <italic>jejf</italic>, <italic>qehq</italic>, <italic>juuy</italic>, <italic>uilk</italic>, and <italic>toco</italic> [<xref ref-type="bibr" rid="CR15">15</xref>], and their corresponding bulk RNA-seq data for each sample [<xref ref-type="bibr" rid="CR24">24</xref>] (<ext-link ext-link-type="uri" xlink:href="http://www.hipsci.org">http://www.hipsci.org</ext-link>). Both scRNA-seq and bulk RNA-seq data sets were downloaded in.bam files and genotyped on 7.4 millions common bi-allelic variants (minor allele frequency &#x0003e;5%) extracted from the 1000 Genome Project with the cellSNP package. For single-cell data, we only keep variants with minor allele frequency &#x02265;0.1 and &#x02265;20 UMIs. For each bulk RNA-seq sample, we also only keep variants with minor allele frequency &#x02265;0.1 but require &#x02265;100 read counts. Then the genotypes of each bulk RNA-seq sample can be used to align to the samples that are demultiplexed from scRNA-seq data.</p></sec><sec id="Sec19"><title>Synthetic data</title><p>We obtained raw 3&#x02019; scRNA-seq data based on 10x Genomics platform (v2 kit) for 16 genetically distinct samples from the Human Cell Atlas (Census of Immune Cells) [<xref ref-type="bibr" rid="CR19">19</xref>]. These data set are not pooled and each sample has its own sequencing run. We only used data from the first channel (each sample with around 100 million reads), which is in the range of a standard 10x sequencing run. We first mapped the raw fastq files to the human genome hg38 by CellRanger v2.1 provided by 10x Genomics (cellranger count command line). Then we used cellSNP to genotype 7.4 million common variants (minor allele frequency &#x0003e;5%) extracted from the 1000 Genome Project for these 16 samples in a pseudo-bulk manner. We only keep variants with: 1) &#x0003e;100 UMIs summarized across 16 samples, 2) &#x0003e;10% UMIs from the minor allele, and 3) &#x0003c;5 UMIs for other alleles (i.e., not annotated reference and alternative alleles). Therefore, we obtained the genotypes of 62,193 variants for these 16 samples, which are fed into Demuxlet and Vireo-GT.</p><p>By only keeping cells with &#x0003e;500 genes and &#x0003e;1000 UMIs, we had in total 66,410 cells across 16 samples, with each sample having 2495 to 4909 cells. On average, there are 4000 UMIs per cell (median 2700 UMIs). In the synthetic mixture, we pooled reads for a subset of cells from each sample (in.bam format, aligned reads) and generated multiplexed scRNA-seq data (also in.bam format). The script to generate these synthetic data is provided in Vireo&#x02019;s GitHub repository. Doublets were added into the pooled data by adding proportional extra cells and combining them with another cells randomly. The doublet rate is <italic>N</italic>/100,000 where <italic>N</italic> is the total number of cells in the pool.</p><p>By default, we pooled 1000 cells from each of 8 samples with doublet rate of 8%. This simulator also allows setting different size of input samples, for example by setting one sample with fewer cells ranging from 50 to 500 (Additional file&#x000a0;<xref rid="MOESM1" ref-type="media">1</xref>: Figure S3). With the synthetic data in.bam format, we can even further subsample reads by using samtools with -s argument, e.g., 15&#x02013;75% in Fig.&#x000a0;<xref rid="Fig3" ref-type="fig">3</xref>f.</p><p>All these simulations were randomly repeated for five times to account for the variability in the simulation.</p></sec></sec><sec sec-type="supplementary-material"><title>Supplementary information</title><sec id="Sec20"><p>
<supplementary-material content-type="local-data" id="MOESM1"><media xlink:href="13059_2019_1865_MOESM1_ESM.pdf"><caption><p><bold>Additional file 1</bold> Supplementary methods and supplementary figures S1&#x02013;S13.</p></caption></media></supplementary-material>
</p><p>
<supplementary-material content-type="local-data" id="MOESM2"><media xlink:href="13059_2019_1865_MOESM2_ESM.docx"><caption><p><bold>Additional file 2</bold> Review history.</p></caption></media></supplementary-material>
</p></sec></sec></body><back><fn-group><fn><p><bold>Publisher&#x02019;s Note</bold></p><p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p></fn></fn-group><sec><title>Supplementary information</title><p><bold>Supplementary information</bold> accompanies this paper at 10.1186/s13059-019-1865-2.</p></sec><ack><title>Acknowledgements</title><p>We would like to thank Raghd Rostom, Maria Ban, Marc Jan Bonder, Stephen Sawcer, and Sarah Teichmann for fruitful discussions. We thank the authors from the Census of Immune Cells project for making their data available prior to publication.</p><sec id="d29e4337"><title>Review history</title><p>The review history is available as Additional file&#x000a0;<xref rid="MOESM2" ref-type="media">2</xref>.</p></sec></ack><notes notes-type="author-contribution"><title>Authors&#x02019; contributions</title><p>O.S. and D.J.M conceived and guided the study. Y.H. developed and implemented the model. YH, DJM and OS carried out the experiments. YH, OS, and DJM interpreted the results and wrote the paper. All authors read and approved the final manuscript.</p></notes><notes notes-type="funding-information"><title>Funding</title><p>Y.H. is supported by the University of Cambridge and EMBL-EBI through an EBPOD postdoctoral fellowship. D.J.M. is supported by National Health and Medical Research Council of Australia through an Early Career Fellowship (GNT1112681) and a Project Grant (GNT1162829). O.S. is supported by core funding from EMBL and DKFZ and the EU (ERC project DECODE 810296). We acknowledge funding from the Wellcome Trust and Medical Research Council (WT098503).</p></notes><notes><title>Ethics approval and consent to participate</title><p>Not applicable.</p></notes><notes notes-type="COI-statement"><title>Competing interests</title><p>The authors declare that they have no competing interests.</p></notes><ref-list id="Bib1"><title>References</title><ref id="CR1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stubbington</surname><given-names>MJ</given-names></name><name><surname>Rozenblatt-Rosen</surname><given-names>O</given-names></name><name><surname>Regev</surname><given-names>A</given-names></name><name><surname>Teichmann</surname><given-names>SA</given-names></name></person-group><article-title>Single-cell transcriptomics to explore the immune system in health and disease</article-title><source>Science</source><year>2017</year><volume>358</volume><issue>6359</issue><fpage>58</fpage><lpage>63</lpage><pub-id pub-id-type="doi">10.1126/science.aan6828</pub-id><pub-id pub-id-type="pmid">28983043</pub-id></element-citation></ref><ref id="CR2"><label>2</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gaublomme</surname><given-names>JT</given-names></name><name><surname>Yosef</surname><given-names>N</given-names></name><name><surname>Lee</surname><given-names>Y</given-names></name><name><surname>Gertner</surname><given-names>RS</given-names></name><name><surname>Yang</surname><given-names>LV</given-names></name><name><surname>Wu</surname><given-names>C</given-names></name><name><surname>Pandolfi</surname><given-names>PP</given-names></name><name><surname>Mak</surname><given-names>T</given-names></name><name><surname>Satija</surname><given-names>R</given-names></name><name><surname>Shalek</surname><given-names>AK</given-names></name><etal/></person-group><article-title>Single-cell genomics unveils critical regulators of Th17 cell pathogenicity</article-title><source>Cell</source><year>2015</year><volume>163</volume><issue>6</issue><fpage>1400</fpage><lpage>12</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2015.11.009</pub-id><pub-id pub-id-type="pmid">26607794</pub-id></element-citation></ref><ref id="CR3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhu</surname><given-names>D</given-names></name><name><surname>Zhao</surname><given-names>Z</given-names></name><name><surname>Cui</surname><given-names>G</given-names></name><name><surname>Chang</surname><given-names>S</given-names></name><name><surname>Hu</surname><given-names>L</given-names></name><name><surname>See</surname><given-names>YX</given-names></name><name><surname>Lim</surname><given-names>MGL</given-names></name><name><surname>Guo</surname><given-names>D</given-names></name><name><surname>Chen</surname><given-names>X</given-names></name><name><surname>Robson</surname><given-names>P</given-names></name><etal/></person-group><article-title>Single-cell transcriptome analysis reveals estrogen signaling coordinately augments one-carbon, polyamine, and purine synthesis in breast cancer</article-title><source>Cell Rep</source><year>2018</year><volume>25</volume><issue>8</issue><fpage>2285</fpage><lpage>98</lpage><pub-id pub-id-type="doi">10.1016/j.celrep.2018.10.093</pub-id><pub-id pub-id-type="pmid">30463022</pub-id></element-citation></ref><ref id="CR4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Golumbeanu</surname><given-names>M</given-names></name><name><surname>Cristinelli</surname><given-names>S</given-names></name><name><surname>Rato</surname><given-names>S</given-names></name><name><surname>Munoz</surname><given-names>M</given-names></name><name><surname>Cavassini</surname><given-names>M</given-names></name><name><surname>Beerenwinkel</surname><given-names>N</given-names></name><name><surname>Ciuffi</surname><given-names>A</given-names></name></person-group><article-title>Single-cell RNA-Seq reveals transcriptional heterogeneity in latent and reactivated HIV-infected cells</article-title><source>Cell Rep</source><year>2018</year><volume>23</volume><issue>4</issue><fpage>942</fpage><lpage>50</lpage><pub-id pub-id-type="doi">10.1016/j.celrep.2018.03.102</pub-id><pub-id pub-id-type="pmid">29694901</pub-id></element-citation></ref><ref id="CR5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tung</surname><given-names>P-Y</given-names></name><name><surname>Blischak</surname><given-names>JD</given-names></name><name><surname>Hsiao</surname><given-names>CJ</given-names></name><name><surname>Knowles</surname><given-names>DA</given-names></name><name><surname>Burnett</surname><given-names>JE</given-names></name><name><surname>Pritchard</surname><given-names>JK</given-names></name><name><surname>Gilad</surname><given-names>Y</given-names></name></person-group><article-title>Batch effects and the effective design of single-cell gene expression studies</article-title><source>Sci Rep</source><year>2017</year><volume>7</volume><fpage>39921</fpage><pub-id pub-id-type="doi">10.1038/srep39921</pub-id><pub-id pub-id-type="pmid">28045081</pub-id></element-citation></ref><ref id="CR6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hicks</surname><given-names>SC</given-names></name><name><surname>Townes</surname><given-names>FW</given-names></name><name><surname>Teng</surname><given-names>M</given-names></name><name><surname>Irizarry</surname><given-names>RA</given-names></name></person-group><article-title>Missing data and technical variability in single-cell rna-sequencing experiments</article-title><source>Biostatistics</source><year>2017</year><volume>19</volume><issue>4</issue><fpage>562</fpage><lpage>78</lpage><pub-id pub-id-type="doi">10.1093/biostatistics/kxx053</pub-id></element-citation></ref><ref id="CR7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Macosko</surname><given-names>EZ</given-names></name><name><surname>Basu</surname><given-names>A</given-names></name><name><surname>Satija</surname><given-names>R</given-names></name><name><surname>Nemesh</surname><given-names>J</given-names></name><name><surname>Shekhar</surname><given-names>K</given-names></name><name><surname>Goldman</surname><given-names>M</given-names></name><name><surname>Tirosh</surname><given-names>I</given-names></name><name><surname>Bialas</surname><given-names>AR</given-names></name><name><surname>Kamitaki</surname><given-names>N</given-names></name><name><surname>Martersteck</surname><given-names>EM</given-names></name><etal/></person-group><article-title>Highly parallel genome-wide expression profiling of individual cells using nanoliter droplets</article-title><source>Cell</source><year>2015</year><volume>161</volume><issue>5</issue><fpage>1202</fpage><lpage>14</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2015.05.002</pub-id><pub-id pub-id-type="pmid">26000488</pub-id></element-citation></ref><ref id="CR8"><label>8</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zheng</surname><given-names>GX</given-names></name><name><surname>Terry</surname><given-names>JM</given-names></name><name><surname>Belgrader</surname><given-names>P</given-names></name><name><surname>Ryvkin</surname><given-names>P</given-names></name><name><surname>Bent</surname><given-names>ZW</given-names></name><name><surname>Wilson</surname><given-names>R</given-names></name><name><surname>Ziraldo</surname><given-names>SB</given-names></name><name><surname>Wheeler</surname><given-names>TD</given-names></name><name><surname>McDermott</surname><given-names>GP</given-names></name><name><surname>Zhu</surname><given-names>J</given-names></name><etal/></person-group><article-title>Massively parallel digital transcriptional profiling of single cells</article-title><source>Nature Commun</source><year>2017</year><volume>8</volume><fpage>14049</fpage><pub-id pub-id-type="doi">10.1038/ncomms14049</pub-id><pub-id pub-id-type="pmid">28091601</pub-id></element-citation></ref><ref id="CR9"><label>9</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stoeckius</surname><given-names>M</given-names></name><name><surname>Zheng</surname><given-names>S</given-names></name><name><surname>Houck-Loomis</surname><given-names>B</given-names></name><name><surname>Hao</surname><given-names>S</given-names></name><name><surname>Yeung</surname><given-names>BZ</given-names></name><name><surname>Mauck</surname><given-names>WM</given-names></name><name><surname>Smibert</surname><given-names>P</given-names></name><name><surname>Satija</surname><given-names>R</given-names></name></person-group><article-title>Cell hashing with barcoded antibodies enables multiplexing and doublet detection for single cell genomics</article-title><source>Genome Biol</source><year>2018</year><volume>19</volume><issue>1</issue><fpage>224</fpage><pub-id pub-id-type="doi">10.1186/s13059-018-1603-1</pub-id><pub-id pub-id-type="pmid">30567574</pub-id></element-citation></ref><ref id="CR10"><label>10</label><mixed-citation publication-type="other">Gehring J, Park JH, Chen S, Thomson M, Pachter L. Highly Multiplexed Single-Cell RNA-seq for Defining Cell Population and Transcriptional Spaces. BioRxiv. 2018;:315333.</mixed-citation></ref><ref id="CR11"><label>11</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McGinnis</surname><given-names>CS</given-names></name><name><surname>Patterson</surname><given-names>DM</given-names></name><name><surname>Winkler</surname><given-names>J</given-names></name><name><surname>Conrad</surname><given-names>DN</given-names></name><name><surname>Hein</surname><given-names>MY</given-names></name><name><surname>Srivastava</surname><given-names>V</given-names></name><name><surname>Hu</surname><given-names>JL</given-names></name><name><surname>Murrow</surname><given-names>LM</given-names></name><name><surname>Weissman</surname><given-names>JS</given-names></name><name><surname>Werb</surname><given-names>Z</given-names></name><etal/></person-group><article-title>MULTI-seq: sample multiplexing for single-cell RNA sequencing using lipid-tagged indices</article-title><source>Nature Meth</source><year>2018</year><volume>16</volume><issue>7</issue><fpage>619</fpage><lpage>26</lpage><pub-id pub-id-type="doi">10.1038/s41592-019-0433-8</pub-id></element-citation></ref><ref id="CR12"><label>12</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shin</surname><given-names>D</given-names></name><name><surname>Lee</surname><given-names>W</given-names></name><name><surname>Lee</surname><given-names>JH</given-names></name><name><surname>Bang</surname><given-names>D</given-names></name></person-group><article-title>Multiplexed single-cell RNA-seq via transient barcoding for simultaneous expression profiling of various drug perturbations</article-title><source>Sci Adv</source><year>2019</year><volume>5</volume><issue>5</issue><fpage>2249</fpage><pub-id pub-id-type="doi">10.1126/sciadv.aav2249</pub-id></element-citation></ref><ref id="CR13"><label>13</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kang</surname><given-names>HM</given-names></name><name><surname>Subramaniam</surname><given-names>M</given-names></name><name><surname>Targ</surname><given-names>S</given-names></name><name><surname>Nguyen</surname><given-names>M</given-names></name><name><surname>Maliskova</surname><given-names>L</given-names></name><name><surname>McCarthy</surname><given-names>E</given-names></name><name><surname>Wan</surname><given-names>E</given-names></name><name><surname>Wong</surname><given-names>S</given-names></name><name><surname>Byrnes</surname><given-names>L</given-names></name><name><surname>Lanata</surname><given-names>CM</given-names></name><etal/></person-group><article-title>Multiplexed droplet single-cell RNA-sequencing using natural genetic variation</article-title><source>Nature Biotechnol</source><year>2018</year><volume>36</volume><issue>1</issue><fpage>89</fpage><pub-id pub-id-type="doi">10.1038/nbt.4042</pub-id><pub-id pub-id-type="pmid">29227470</pub-id></element-citation></ref><ref id="CR14"><label>14</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Haque</surname><given-names>A</given-names></name><name><surname>Engel</surname><given-names>J</given-names></name><name><surname>Teichmann</surname><given-names>SA</given-names></name><name><surname>L&#x000f6;nnberg</surname><given-names>T</given-names></name></person-group><article-title>A practical guide to single-cell rna-sequencing for biomedical research and clinical applications</article-title><source>Genome Med</source><year>2017</year><volume>9</volume><issue>1</issue><fpage>75</fpage><pub-id pub-id-type="doi">10.1186/s13073-017-0467-4</pub-id><pub-id pub-id-type="pmid">28821273</pub-id></element-citation></ref><ref id="CR15"><label>15</label><mixed-citation publication-type="other">Cuomo AS, Seaton DD, McCarthy DJ, Martinez I, Bonder MJ, Garcia-Bernardo J, Amatya S, Madrigal P, Isaacson A, Buettner F, et al. Single-cell RNA-sequencing of differentiating iPS cells reveals dynamic genetic effects on gene expression. BioRxiv. 2019;:630996.</mixed-citation></ref><ref id="CR16"><label>16</label><mixed-citation publication-type="other">McCarthy DJ, Rostom R, Huang Y, Kunz DJ, Danecek P, Bonder MJ, Hagai T, Wang W, Gaffney DJ, Simons BD, et al. Cardelino: Integrating whole exomes and single-cell transcriptomes to reveal phenotypic impact of somatic variants. BioRxiv. 2018;:413047.</mixed-citation></ref><ref id="CR17"><label>17</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>van der Wijst</surname><given-names>MG</given-names></name><name><surname>Brugge</surname><given-names>H</given-names></name><name><surname>de Vries</surname><given-names>DH</given-names></name><name><surname>Deelen</surname><given-names>P</given-names></name><name><surname>Swertz</surname><given-names>MA</given-names></name><name><surname>Franke</surname><given-names>L</given-names></name></person-group><article-title>Single-cell RNA sequencing identifies celltype-specific cis-eQTLs and co-expression QTLs</article-title><source>Nat Genet</source><year>2018</year><volume>50</volume><issue>4</issue><fpage>493</fpage><pub-id pub-id-type="doi">10.1038/s41588-018-0089-9</pub-id><pub-id pub-id-type="pmid">29610479</pub-id></element-citation></ref><ref id="CR18"><label>18</label><element-citation publication-type="journal"><person-group person-group-type="author"><collab>1000 Genomes Project Consortium and others</collab></person-group><article-title>A global reference for human genetic variation</article-title><source>Nature</source><year>2015</year><volume>526</volume><issue>7571</issue><fpage>68</fpage><pub-id pub-id-type="doi">10.1038/nature15393</pub-id><pub-id pub-id-type="pmid">26432245</pub-id></element-citation></ref><ref id="CR19"><label>19</label><mixed-citation publication-type="other">Li B, Kowalczyk MS, Dionne D, Ashenberg O, Tabaka M, Tickle T, Lee J, Shekhar K, Slyper M, Waldman J, Rozenblatt-Rosen O, Regev A, Census of Immune Cells. 2018. <ext-link ext-link-type="uri" xlink:href="https://data.humancellatlas.org">https://data.humancellatlas.org</ext-link>. Accessed 12 April 2019.</mixed-citation></ref><ref id="CR20"><label>20</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wolf</surname><given-names>FA</given-names></name><name><surname>Angerer</surname><given-names>P</given-names></name><name><surname>Theis</surname><given-names>FJ</given-names></name></person-group><article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title><source>Genome Biol</source><year>2018</year><volume>19</volume><issue>1</issue><fpage>15</fpage><pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id><pub-id pub-id-type="pmid">29409532</pub-id></element-citation></ref><ref id="CR21"><label>21</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McCarthy</surname><given-names>DJ</given-names></name><name><surname>Chen</surname><given-names>Y</given-names></name><name><surname>Smyth</surname><given-names>GK</given-names></name></person-group><article-title>Differential expression analysis of multifactor RNA-Seq experiments with respect to biological variation</article-title><source>Nucleic Acids Res</source><year>2012</year><volume>40</volume><issue>10</issue><fpage>4288</fpage><lpage>97</lpage><pub-id pub-id-type="doi">10.1093/nar/gks042</pub-id><pub-id pub-id-type="pmid">22287627</pub-id></element-citation></ref><ref id="CR22"><label>22</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Blei</surname><given-names>DM</given-names></name><name><surname>Kucukelbir</surname><given-names>A</given-names></name><name><surname>McAuliffe</surname><given-names>JD</given-names></name></person-group><article-title>Variational inference: A review for statisticians</article-title><source>J Am Stat Assoc</source><year>2017</year><volume>112</volume><issue>518</issue><fpage>859</fpage><lpage>77</lpage><pub-id pub-id-type="doi">10.1080/01621459.2017.1285773</pub-id></element-citation></ref><ref id="CR23"><label>23</label><mixed-citation publication-type="other">Huang Y. CellSNP version 0.1.6. 2019. 10.5281/zenodo.3516640. <ext-link ext-link-type="uri" xlink:href="https://zenodo.org/record/3516640">https://zenodo.org/record/3516640</ext-link>.</mixed-citation></ref><ref id="CR24"><label>24</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kilpinen</surname><given-names>H</given-names></name><name><surname>Goncalves</surname><given-names>A</given-names></name><name><surname>Leha</surname><given-names>A</given-names></name><name><surname>Afzal</surname><given-names>V</given-names></name><name><surname>Alasoo</surname><given-names>K</given-names></name><name><surname>Ashford</surname><given-names>S</given-names></name><name><surname>Bala</surname><given-names>S</given-names></name><name><surname>Bensaddek</surname><given-names>D</given-names></name><name><surname>Casale</surname><given-names>FP</given-names></name><name><surname>Culley</surname><given-names>OJ</given-names></name><etal/></person-group><article-title>Common genetic variation drives molecular heterogeneity in human iPSCs</article-title><source>Nature</source><year>2017</year><volume>546</volume><issue>7658</issue><fpage>370</fpage><pub-id pub-id-type="doi">10.1038/nature22403</pub-id><pub-id pub-id-type="pmid">28489815</pub-id></element-citation></ref><ref id="CR25"><label>25</label><mixed-citation publication-type="other">Huang Y, McCarthy DJ, Stegle O. Vireo version 0.1.5. 2019. 10.5281/zenodo.3516639. <ext-link ext-link-type="uri" xlink:href="https://zenodo.org/record/3516639">https://zenodo.org/record/3516639</ext-link>.</mixed-citation></ref></ref-list></back></article>